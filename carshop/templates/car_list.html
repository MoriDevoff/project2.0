{% extends 'base.html' %}

{% block content %}
<main class="container mx-auto py-6 md:py-10 px-4">
    <h2 class="text-2xl md:text-4xl font-extrabold text-center mb-6 md:mb-8 text-gray-900 fade-in">Доступные автомобили</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
        {% for car in cars %}
            <div class="card-hover bg-white rounded-xl shadow-md overflow-hidden transform transition-all duration-300">
                <div class="relative">
                    <img id="main-photo-{{ car.id }}" src="{% if car.carphoto_set.exists %}{{ car.carphoto_set.first.photo_url }}{% elif car.main_photo_url %}{{ car.main_photo_url }}{% else %}https://via.placeholder.com/150{% endif %}" alt="{{ car.brand }} {{ car.model }}" class="w-full h-48 md:h-56 object-cover">
                    {% if car.carphoto_set.exists %}
                        <select onchange="changeMainPhoto('{{ car.id }}', this.value)" class="absolute top-2 right-2 bg-white p-1 rounded text-sm">
                            {% for photo in car.carphoto_set.all %}
                                <option value="{{ photo.photo_url }}">{{ photo.photo_url|truncatechars:20 }}</option>
                            {% endfor %}
                            {% if car.main_photo_url %}
                                <option value="{{ car.main_photo_url }}">{{ car.main_photo_url|truncatechars:20 }}</option>
                            {% endif %}
                        </select>
                    {% endif %}
                </div>
                <div class="p-4 md:p-6">
                    <h3 class="text-lg md:text-2xl font-semibold text-gray-900">{{ car.brand }} {{ car.model }} ({{ car.year }})</h3>
                    <p class="text-lg md:text-xl text-yellow-600 mt-2 font-bold">{{ car.price }} ₽</p>
                    <p class="text-gray-600 mt-2 text-sm md:text-base">{{ car.mileage }} км | {{ car.fuel_type }} | {{ car.transmission }}</p>
                    <p class="text-gray-500 mt-1 text-sm md:text-base line-clamp-2">{{ car.description }}</p>
                    <a href="{% url 'car_detail' car.id %}" class="mt-4 inline-block bg-blue-600 text-white px-4 md:px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm md:text-base">
                        Подробнее <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </div>
        {% empty %}
            <p class="text-center text-gray-600 col-span-full">Автомобили не найдены.</p>
        {% endfor %}
    </div>
</main>

<script>
function changeMainPhoto(carId, photoUrl) {
    document.getElementById('main-photo-' + carId).src = photoUrl;
}
</script>
{% endblock %}