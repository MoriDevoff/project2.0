{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in">
    <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-6 text-center">
        {{ car.brand }} {{ car.model }} ({{ car.year }})
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            {% if car.carphoto_set.exists or car.main_photo_url %}
                <div id="carousel-{{ car.id }}" class="relative">
                    {% for photo in car.carphoto_set.all %}
                        <img src="{{ photo.photo_url }}" alt="{{ car.brand }} {{ car.model }}" class="carousel-image w-full h-64 md:h-80 object-cover rounded-lg hidden">
                    {% endfor %}
                    {% if car.main_photo_url %}
                        <img src="{{ car.main_photo_url }}" alt="{{ car.brand }} {{ car.model }}" class="carousel-image w-full h-64 md:h-80 object-cover rounded-lg hidden">
                    {% endif %}
                    <button onclick="prevImage('{{ car.id }}')" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full hover:bg-gray-600">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button onclick="nextImage('{{ car.id }}')" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white p-2 rounded-full hover:bg-gray-600">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            {% else %}
                <img src="https://via.placeholder.com/150" alt="Нет фото" class="w-full h-64 md:h-80 object-cover rounded-lg">
            {% endif %}
        </div>
        <div>
            <p class="text-lg md:text-xl text-yellow-600 font-bold">{{ car.price }} ₽</p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Пробег:</strong> {{ car.mileage }} км
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Тип топлива:</strong> {{ car.fuel_type }}
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Трансмиссия:</strong> {{ car.transmission }}
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Цвет:</strong> {{ car.color }}
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Объем двигателя:</strong> {{ car.engine_capacity }} л
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Описание:</strong> {{ car.description|default:"Описание отсутствует" }}
            </p>
            <p class="text-gray-600 mt-2 text-sm md:text-base">
                <strong>Создано:</strong> {{ car.created_at|date:"d.m.Y H:i" }}
            </p>
        </div>
    </div>
    <div class="mt-6 text-center">
        <a href="{% url 'car_list' %}" class="inline-block bg-blue-600 text-white px-4 md:px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm md:text-base">
            Назад к списку <i class="fas fa-arrow-left ml-2"></i>
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('carousel-{{ car.id }}');
    if (carousel) {
        const images = carousel.getElementsByClassName('carousel-image');
        if (images.length > 0) {
            images[0].classList.remove('hidden');
        }
    }
});

let currentIndex{{ car.id }} = 0;

function showImage(carId, index) {
    const carousel = document.getElementById('carousel-' + carId);
    const images = carousel.getElementsByClassName('carousel-image');
    for (let i = 0; i < images.length; i++) {
        images[i].classList.add('hidden');
    }
    images[index].classList.remove('hidden');
}

function nextImage(carId) {
    const carousel = document.getElementById('carousel-' + carId);
    const images = carousel.getElementsByClassName('carousel-image');
    currentIndex{{ car.id }} = (currentIndex{{ car.id }} + 1) % images.length;
    showImage(carId, currentIndex{{ car.id }});
}

function prevImage(carId) {
    const carousel = document.getElementById('carousel-' + carId);
    const images = carousel.getElementsByClassName('carousel-image');
    currentIndex{{ car.id }} = (currentIndex{{ car.id }} - 1 + images.length) % images.length;
    showImage(carId, currentIndex{{ car.id }});
}
</script>
{% endblock %}